---
- block:

  - name: instala iptables - debian
    apt:
      name: iptables
      state: present
    when: ansible_distribution == "Debian"

  - name: instala iptables - arch
    pacman:
      name: iptables
      state: present
    when: ansible_distribution == "Archlinux"

  - name: copia unit do systemd para firewall
    template:
      src: firewall.service.j2
      dest: /etc/systemd/system/firewall.service
      owner: root
      group: root
      mode: 0644
    notify:
      - recarrega units systemd
      - reinicia firewall

  - name: copia script do firewall
    template:
      src: firewall.sh.j2
      dest: /etc/firewall.sh
      owner: root
      group: root
      mode: 0700
    notify: reinicia firewall

  - name: ativa ou desativa firewall no systemd
    systemd:
      name: firewall
      enabled: "{{ firewall_enabled }}"
      state: "{{ firewall_enabled|bool and 'started' or 'stopped' }}"

  tags: firewall
