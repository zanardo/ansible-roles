---
- name: instala locales
  apt:
    name: locales
    state: present

- name: ativa locales necessários
  lineinfile:
    dest: /etc/locale.gen
    line: "{{ item }}"
    regexp: "^(?# *){{ item }}"
    state: present
  with_items:
    - "pt_BR ISO-8859-1"
    - "pt_BR.UTF-8 UTF-8"
    - "en_US ISO-8859-1"
    - "en_US.UTF-8 UTF-8"
  register: locale_gen
  tags: ["postgresql"]

- name: recompila locale
  command: locale-gen
  when: locale_gen|changed()
  tags: ["postgresql"]

- name: instala postgresql
  apt:
    name: "{{ item }}"
    state: present
  with_items:
    - "postgresql-{{ postgresql_version }}"
    - "postgresql-contrib-{{ postgresql_version }}"
  tags: ["postgresql"]

- name: copia arquivos de configuração
  template:
    src: "{{ postgresql_conf }}/{{ item }}"
    dest: "/etc/postgresql/{{ postgresql_version }}/main/{{ item }}"
  notify: 
    - reinicia postgresql
    - aguarda postgresql iniciar
  with_items: "{{ postgresql_conf_files }}"
  tags: ["postgresql", "postgresql:conf"]
